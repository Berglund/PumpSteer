# .github/workflows/ci.yml - UPPDATERAD MED CONTINUE-ON-ERROR
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  lint:
    name: Code Quality
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install black flake8 isort mypy
        pip install homeassistant
    
    - name: Black formatting check (warning only)
      run: |
        echo "üîç Checking Black formatting..."
        if ! black --check --diff custom_components/; then
          echo "‚ö†Ô∏è  WARNING: Code is not Black-formatted"
          echo "üí° Run 'black custom_components/' to fix"
          echo "ü§ñ Or use the Auto-fix workflow in Actions"
        else
          echo "‚úÖ Black formatting is correct"
        fi
      continue-on-error: true
    
    - name: Flake8 linting
      run: |
        echo "üîç Checking code quality with Flake8..."
        flake8 custom_components/ --max-line-length=88 --extend-ignore=E203,W503 || echo "‚ö†Ô∏è  Found some code quality issues"
      continue-on-error: true
    
    - name: Import sorting check (warning only)
      run: |
        echo "üîç Checking import sorting..."
        if ! isort --check-only --diff custom_components/; then
          echo "‚ö†Ô∏è  WARNING: Imports are not sorted correctly"
          echo "üí° Run 'isort custom_components/' to fix"
        else
          echo "‚úÖ Import sorting is correct"
        fi
      continue-on-error: true
    
    - name: Type checking with mypy (warning only)
      run: |
        echo "üîç Running type checks..."
        mypy custom_components/ --ignore-missing-imports || echo "‚ö†Ô∏è  Found some type issues"
      continue-on-error: true
      
    - name: Summary
      run: |
        echo "üìã Code Quality Summary:"
        echo "- This workflow checks code quality but doesn't fail the build"
        echo "- Use the 'Auto-fix Code Issues' workflow to automatically fix formatting"
        echo "- Or run tools locally: black, isort, flake8"
